<!DOCTYPE HTML>
<html>
	<head>
		<title>Create Point</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
		<link rel='stylesheet' type='text/css' href="principal.css">
		<script src="http://www.openlayers.org/api/OpenLayers.js"></script>
		<script>
			var map,markers,point_clicked;
			var zoom = 16;
			var curpos = new Array();
			
			var tanguy_tower = [48.383410, -4.496798]
			
			var fromProjection = new OpenLayers.Projection("EPSG:4326");   // Transform from WGS 1984
			var toProjection   = new OpenLayers.Projection("EPSG:900913"); // to Spherical Mercator Projection
			
			var cntrposition = new OpenLayers.LonLat(tanguy_tower[1], tanguy_tower[0]).transform( fromProjection, toProjection);
			
			function init()
			{
				map = new OpenLayers.Map("Map");
				markers = new OpenLayers.Layer.Markers("Markers");
				
				var mapnik = new OpenLayers.Layer.OSM("MAP"); 
				
				map.addLayers([mapnik,markers]);
				map.setCenter(cntrposition, zoom);
				
				var click = new OpenLayers.Control.Click();
				map.addControl(click);
				click.activate();
			};
			
			
			OpenLayers.Control.Click = OpenLayers.Class(OpenLayers.Control, {               
				defaultHandlerOptions: {
					'single': true,
					'double': false,
					'pixelTolerance': 0,
					'stopSingle': false,
					'stopDouble': false
				},
				
				initialize: function(options) {
					this.handlerOptions = OpenLayers.Util.extend(
					{}, this.defaultHandlerOptions
					);
					OpenLayers.Control.prototype.initialize.apply(
					this, arguments
					);
					this.handler = new OpenLayers.Handler.Click(
					this, {
						'click': this.trigger
					}, this.handlerOptions
					);
				},
				
				trigger: function(e) {
					// get point values
					var lonlat = map.getLonLatFromPixel(e.xy);
					point_clicked = new OpenLayers.LonLat(lonlat.lon,lonlat.lat).transform(toProjection,fromProjection);
					
					// remove old markers
					if(map.layers[1]){
						map.layers[1].clearMarkers()
					}
					
					// add marker to map
					markers.addMarker(new OpenLayers.Marker(point_clicked));
					
					// add point data to form boxes
					document.getElementById("form_latitude").value = point_clicked.lat
					document.getElementById("form_longitude").value = point_clicked.lon
				}
				
			});
		</script>
	</head>
	
	<body onload='init();'>
		<nav class="navbar navbar-inverse">
			<div class="container-fluid">
				<div class="navbar-header">
					<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>                        
					</button>
					<a class="navbar-brand" href="initial.html">WB</a>
				</div>
				<div class="collapse navbar-collapse" id="myNavbar">
					<ul class="nav navbar-nav">
						<li><a href="principal.html">Balades</a></li>
						<li class="active"><a href="">Param√®tres</a></li>
					</ul>
					<ul class="nav navbar-nav navbar-right">
						<li><a href="contact.html"><span class="glyphicon glyphicon-earphone "></span> Contact</a></li>
						<li><a href="login_s4.html"><span class="glyphicon glyphicon-log-in"></span> Login</a></li>
					</ul>
				</div>
			</nav>
		<div class="container-fluid">
			<div class="row">
				<div class="col-sm-4">
					<form class="form-horizontal">
  						<div class="form-group">
    						<label class="control-label col-sm-3" for="form_name">Nom:</label>
    						<div class="col-sm-9">
      							<input type="text" class="form-control" id="form_name" placeholder="Entrez le nom du nouveau point">
    						</div>
  						</div>
  						<div class="form-group">
    						<label class="control-label col-sm-3" for="form_latitude">Latitude:</label>
    						<div class="col-sm-9">
      							<input type="text" class="form-control" id="form_latitude">
    						</div>
  						</div>
  						<div class="form-group">
    						<label class="control-label col-sm-3" for="form_longitude">Longitude:</label>
    						<div class="col-sm-9">
      							<input type="text" class="form-control" id="form_longitude">
    						</div>
  						</div>
					  	<div class="form-group"> 
					    	<div class="col-sm-offset-3 col-sm-9">
					      	<button type="submit" class="btn btn-default">Submit</button>
					    	</div>
					  	</div>
					</form>
				</div>
				<div class="col-sm-8">
					<div style="width: 100%; height: 550px"  id="Map" ></div>
				</div>
			</div>
		</div>
		
	</body>
	
</html>