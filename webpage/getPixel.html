<!DOCTYPE HTML>
<html>
	<head>
		<title>Create Point</title>
		<script src="http://www.openlayers.org/api/OpenLayers.js"></script>
		<script>
			var map,markers,point_clicked;
			var zoom = 16;
			var curpos = new Array();
			
			var tanguy_tower = [48.383410, -4.496798]
			
			var fromProjection = new OpenLayers.Projection("EPSG:4326");   // Transform from WGS 1984
			var toProjection   = new OpenLayers.Projection("EPSG:900913"); // to Spherical Mercator Projection
			
			var cntrposition = new OpenLayers.LonLat(tanguy_tower[1], tanguy_tower[0]).transform( fromProjection, toProjection);
			
			function init()
			{
				map = new OpenLayers.Map("Map");
				markers = new OpenLayers.Layer.Markers("Markers");
				
				var mapnik = new OpenLayers.Layer.OSM("MAP"); 
				
				map.addLayers([mapnik,markers]);
				map.setCenter(cntrposition, zoom);
				
				var click = new OpenLayers.Control.Click();
				map.addControl(click);
				click.activate();
			};
			
			
			OpenLayers.Control.Click = OpenLayers.Class(OpenLayers.Control, {               
				defaultHandlerOptions: {
					'single': true,
					'double': false,
					'pixelTolerance': 0,
					'stopSingle': false,
					'stopDouble': false
				},
				
				initialize: function(options) {
					this.handlerOptions = OpenLayers.Util.extend(
					{}, this.defaultHandlerOptions
					);
					OpenLayers.Control.prototype.initialize.apply(
					this, arguments
					);
					this.handler = new OpenLayers.Handler.Click(
					this, {
						'click': this.trigger
					}, this.handlerOptions
					);
				},
				
				trigger: function(e) {
					// get point values
					point_clicked = map.getLonLatFromPixel(e.xy);
					
					// remove old markers
					if(map.layers[1]){
						map.layers[1].clearMarkers()
					}
					
					// add marker to map
					markers.addMarker(new OpenLayers.Marker(point_clicked));
					
					// add point data to form boxes
					document.getElementById("form_latitude").value = point_clicked.lat
					document.getElementById("form_longitude").value = point_clicked.lon
				}
				
			});
		</script>
	</head>
	
	<body onload='init();'>
		<div style="width: 100%; height: 400px"  id="Map" ></div>
		<form action="" method="get">
			Nom du nouveau point:
			<input type="text" id="form_name" value="" maxlength="100" />
			<br/>
			Latitude:
			<input type="text" id="form_latitude" value="" maxlength="100" />
			<br/>
			Longitude:
			<input type="text" id="form_longitude" value="" maxlength="100" />
			<input type="submit" value="Submit" />
		</form>
		
	</body>
	
</html>